# ============================================================================
# Truxe API Configuration Template
# ============================================================================
#
# This is a template file. Copy it to create your environment-specific config:
#   - .env (local development) - DO NOT COMMIT
#   - .env.production (production) - DO NOT COMMIT
#   - .env.staging (staging) - DO NOT COMMIT
#
# SECURITY: Never commit files containing actual secrets to git!
# ============================================================================

# ============================================================================
# Application Settings
# ============================================================================

NODE_ENV=development
PORT=3001  # Internal container port (DO NOT CHANGE - for Docker internal use)
LOG_LEVEL=info
API_VERSION=v1

# ============================================================================
# Port Management (87000-87999 Range)
# ============================================================================
#
# Truxe uses a dedicated port range (87000-87999) to avoid conflicts.
# This follows industry best practices for on-premise deployments.
#
# Port Mapping Strategy:
#   - External (Host): 87XXX range (custom for conflict avoidance)
#   - Internal (Container): Industry standard defaults (5432, 6379, 3001)
#   - Pattern: external_port:internal_port (e.g., 87032:5432)
#
# Environment Ranges:
#   - Development: 87000-87099
#   - Testing:     87100-87199
#   - Staging:     87200-87299
#   - Production:  87300-87399
#
# Reference: docs/deployment/PORT_MAPPING_STRATEGY.md

# Current Environment
TRUXE_ENV=development

# Port Range for Current Environment
TRUXE_PORT_RANGE_START=87000
TRUXE_PORT_RANGE_END=87099

# Service Ports (External/Host - for accessing from outside Docker)
TRUXE_API_PORT=87001
TRUXE_DB_PORT=87032
TRUXE_REDIS_PORT=87079
TRUXE_MAILHOG_SMTP_PORT=87025
TRUXE_MAILHOG_WEB_PORT=87825
TRUXE_MONITORING_PORT=87090

# Port Validation
TRUXE_PORT_VALIDATION=true
TRUXE_PORT_CONFLICT_CHECK=true

# ============================================================================
# Domain Configuration
# ============================================================================

# Local: http://localhost:87001 (external access)
# Container: http://api:3001 (internal Docker network)
# Prod: https://api.truxe.io
DOMAIN=localhost
API_URL=http://localhost:87001
FRONTEND_URL=http://localhost:3000

# ============================================================================
# Database Configuration
# ============================================================================

# Connection Strings:
#   From Host Machine: Use localhost + TRUXE_DB_PORT (87032)
#   From Docker Container: Use service name + internal port (database:5432)
#
# Local (from host): postgresql://truxe.io_password@localhost:87032/truxe.io
# Docker (container-to-container): postgresql://truxe.io_password@database:5432/truxe.io
# Prod (container-to-container): postgresql://truxe:prod_password@database:5432/truxe.io
DATABASE_URL=postgresql://truxe:your_password@localhost:87032/truxe.io

# Database Pool Configuration
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10

# PostgreSQL Direct Settings (for Docker)
POSTGRES_USER=truxe
POSTGRES_PASSWORD=your_secure_password_here
POSTGRES_DB=truxe.io
DB_PASSWORD=your_secure_password_here

# ============================================================================
# Redis Configuration
# ============================================================================

# Connection Strings:
#   From Host Machine: Use localhost + TRUXE_REDIS_PORT (87079)
#   From Docker Container: Use service name + internal port (redis:6379)
#
# Local (from host): redis://:dev_password@localhost:87079
# Docker (container-to-container): redis://:dev_password@redis:6379
# Prod (container-to-container): redis://:prod_password@redis:6379
REDIS_URL=redis://:your_redis_password@localhost:87079
REDIS_PASSWORD=your_redis_password
REDIS_MAX_RETRIES=3

# ============================================================================
# JWT Configuration
# ============================================================================

JWT_ALGORITHM=RS256
JWT_ISSUER=https://auth.truxe.io
JWT_AUDIENCE=truxe-api
JWT_ACCESS_TOKEN_TTL=15m
JWT_REFRESH_TOKEN_TTL=30d

# JWT Keys (Base64 Encoded)
# Generate with: npm run generate-keys
# For development, keys can be in PEM format directly
# For production, use base64 encoded keys
JWT_PRIVATE_KEY_BASE64=your_base64_encoded_private_key_here
JWT_PUBLIC_KEY_BASE64=your_base64_encoded_public_key_here

# OR use direct PEM keys (development only)
# JWT_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----"
# JWT_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----"

# ============================================================================
# Email Configuration
# ============================================================================

# Provider: smtp, brevo, resend, ses
EMAIL_PROVIDER=smtp
EMAIL_FROM=noreply@truxe.io
EMAIL_FROM_NAME=Truxe Auth

# Brevo (Production recommended)
BREVO_API_KEY=your_brevo_api_key_here

# Resend (Alternative)
RESEND_API_KEY=your_resend_api_key_here

# AWS SES (Enterprise)
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your_aws_access_key
AWS_SECRET_ACCESS_KEY=your_aws_secret_key

# SMTP (Local development)
# From Host: Use localhost + TRUXE_MAILHOG_SMTP_PORT (87025)
# From Docker: Use service name + internal port (mailhog:1025)
SMTP_HOST=localhost
SMTP_PORT=87025
SMTP_SECURE=false
SMTP_USER=
SMTP_PASS=

# ============================================================================
# CORS Configuration
# ============================================================================

# Comma-separated list of allowed origins
# Local: http://localhost:3000
# Prod: https://app.truxe.io
CORS_ORIGIN=http://localhost:3000

# ============================================================================
# Magic Link Configuration
# ============================================================================

MAGIC_LINK_TTL=15m
# Frontend URL where users will complete authentication
MAGIC_LINK_BASE_URL=http://localhost:3000

# ============================================================================
# Rate Limiting
# ============================================================================

ENABLE_RATE_LIMITING=true
RATE_LIMIT_MAGIC_LINK_PER_IP=10
RATE_LIMIT_MAGIC_LINK_WINDOW=1m

# ============================================================================
# Security Configuration
# ============================================================================

ENABLE_HELMET=true
ENABLE_SECURITY_HEADERS=true

# Generate with: openssl rand -hex 32
COOKIE_SECRET=your_cookie_secret_32_bytes_hex
SESSION_SECRET=your_session_secret_32_bytes_hex

# ============================================================================
# Feature Flags
# ============================================================================

ENABLE_SIGNUP=true
ENABLE_MAGIC_LINKS=true
ENABLE_WEBHOOKS=true
ENABLE_OAUTH=true
ENABLE_MULTI_TENANCY=false

# ============================================================================
# Background Jobs Configuration (v0.3)
# ============================================================================

# Enable BullMQ-based background job queue system (default: false for safe rollout)
# Set to 'true' to use BullMQ for background jobs (emails, webhooks, cleanup)
# Set to 'false' to use legacy setInterval-based jobs (for rollback)
USE_BULLMQ_QUEUES=false

# Alert Notification Channels
ALERT_NOTIFICATIONS_ENABLED=true
ALERT_NOTIFICATIONS_DEDUP_WINDOW=5m
ALERT_NOTIFICATIONS_MAX_RETRIES=3
ALERT_NOTIFICATIONS_RETRY_DELAY=5s
ALERT_NOTIFICATIONS_RETRY_BACKOFF=15s

# Email Alerts
ALERT_EMAIL_ENABLED=true
ALERT_EMAIL_RECIPIENTS=ops@company.com,team@company.com

# Slack Alerts
ALERT_SLACK_ENABLED=true
ALERT_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/XXX/YYY/ZZZ
ALERT_SLACK_CHANNEL=#alerts

# PagerDuty Alerts (Optional)
ALERT_PAGERDUTY_ENABLED=false
ALERT_PAGERDUTY_INTEGRATION_KEY=your_pagerduty_integration_key
ALERT_PAGERDUTY_SOURCE=Truxe API
ALERT_PAGERDUTY_SERVICE=alert-notifications

# ============================================================================
# OAuth Configuration (v0.2)
# ============================================================================

# OAuth Callback Base URL
# Local (external): http://localhost:87001
# Local (internal Docker): http://api:3001
# Prod: https://api.truxe.io
OAUTH_CALLBACK_BASE_URL=http://localhost:87001

# OAuth Secrets (32 bytes hex)
# Generate with: openssl rand -hex 32
OAUTH_STATE_SECRET=your_oauth_state_secret_32_bytes_hex
OAUTH_TOKEN_ENCRYPTION_KEY=your_oauth_token_encryption_key_32_bytes_hex

# ============================================================================
# Google OAuth Configuration
# ============================================================================

# Create app at: https://console.cloud.google.com/apis/credentials
GOOGLE_OAUTH_CLIENT_ID=your_google_client_id.apps.googleusercontent.com
GOOGLE_OAUTH_CLIENT_SECRET=your_google_client_secret
GOOGLE_OAUTH_REDIRECT_URI=http://localhost:87001/auth/oauth/callback/google

# ============================================================================
# GitHub OAuth Configuration
# ============================================================================

# Create app at: https://github.com/settings/developers
# Local app: http://localhost:87001/auth/oauth/callback/github
# Prod app: https://api.truxe.io/auth/oauth/callback/github
GITHUB_OAUTH_CLIENT_ID=your_github_client_id
GITHUB_OAUTH_CLIENT_SECRET=your_github_client_secret
GITHUB_OAUTH_REDIRECT_URI=http://localhost:87001/auth/oauth/callback/github

# GitHub API Configuration
GITHUB_DEFAULT_SCOPES=read:user,user:email
GITHUB_API_VERSION=2022-11-28
GITHUB_USER_AGENT=Truxe-Auth

# Optional: GitHub App (for advanced features - Phase 5)
# GITHUB_APP_ID=your_app_id
# GITHUB_APP_PRIVATE_KEY_FILE=/path/to/private-key.pem
# GITHUB_APP_WEBHOOK_SECRET=your_webhook_secret

# Optional: GitHub Enterprise
# GITHUB_ENTERPRISE_URL=https://github.yourcompany.com

# ============================================================================
# Apple OAuth Configuration (Sign in with Apple)
# ============================================================================

# Create app at: https://developer.apple.com/account/resources/identifiers/list/serviceId
# Requires Apple Developer Program membership ($99/year)
APPLE_OAUTH_ENABLED=false
APPLE_OAUTH_CLIENT_ID=your.service.id
APPLE_OAUTH_TEAM_ID=YOUR_TEAM_ID
APPLE_OAUTH_KEY_ID=YOUR_KEY_ID
APPLE_OAUTH_PRIVATE_KEY=your_base64_encoded_private_key_here
APPLE_OAUTH_CALLBACK_URL=http://localhost:87001/auth/oauth/callback/apple

# Note: Apple uses JWT-based client secret generation
# The private key should be base64 encoded or in PEM format
# Download from: https://developer.apple.com/account/resources/authkeys/list

# ============================================================================
# Microsoft OAuth Configuration (Azure AD + Personal Accounts)
# ============================================================================

# Create app at: https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationsListBlade
MICROSOFT_OAUTH_ENABLED=false
MICROSOFT_OAUTH_CLIENT_ID=your_microsoft_client_id
MICROSOFT_OAUTH_CLIENT_SECRET=your_microsoft_client_secret
MICROSOFT_OAUTH_CALLBACK_URL=http://localhost:87001/auth/oauth/callback/microsoft

# Tenant options:
# - 'common' = personal Microsoft accounts + work/school accounts (recommended)
# - 'organizations' = work/school accounts only
# - 'consumers' = personal Microsoft accounts only
# - '{tenant-id}' = specific Azure AD tenant only
MICROSOFT_OAUTH_TENANT=common

# Microsoft Graph API scopes (default: openid,email,profile,User.Read)
MICROSOFT_OAUTH_SCOPES=openid,email,profile,User.Read

# ============================================================================
# Monitoring & Metrics
# ============================================================================

ENABLE_METRICS=true
# Internal port (inside container): 9090
# External port (from host): Use TRUXE_MONITORING_PORT (87090)
METRICS_PORT=9090
ENABLE_PROMETHEUS_METRICS=false

# ============================================================================
# Logging Configuration
# ============================================================================

# Format: json, pretty
LOG_FORMAT=pretty
LOG_DESTINATION=stdout

# ============================================================================
# Development-Only Settings
# ============================================================================

# Enable in development for debugging
# DEBUG=truxe:*
# NODE_OPTIONS=--inspect

# ============================================================================
# Production-Only Settings
# ============================================================================

# Uncomment for production
# NODE_ENV=production
# LOG_FORMAT=json
# ENABLE_PROMETHEUS_METRICS=true

# ============================================================================
# Notes
# ============================================================================
#
# 1. Security Best Practices:
#    - Generate unique secrets for each environment
#    - Use strong passwords (min 32 characters)
#    - Never commit .env files to git
#    - Use environment variables in CI/CD
#    - Rotate secrets regularly (quarterly recommended)
#
# 2. Environment Setup:
#    Local Development:
#      cp .env.example .env
#      # Edit .env with your local settings
#      npm run generate-keys  # Generate JWT keys
#
#    Production:
#      cp .env.example .env.production
#      # Edit .env.production with production settings
#      # Use deployment platform's secret management
#
# 3. Required Services:
#    - PostgreSQL 14+ (database) - Port 87032 (external) → 5432 (internal)
#    - Redis 6+ (caching, rate limiting) - Port 87079 (external) → 6379 (internal)
#    - SMTP server or email service (for magic links) - Port 87025 (external) → 1025 (internal)
#    - MailHog Web UI (development) - Port 87825
#
# 4. Port Management:
#    - All services use 87000-87999 range (external access from host)
#    - Internal Docker network uses standard ports (5432, 6379, 3001, etc.)
#    - See docs/deployment/PORT_MAPPING_STRATEGY.md for details
#
#    Access from Host Machine:
#      API: http://localhost:87001
#      Database: localhost:87032
#      Redis: localhost:87079
#      MailHog UI: http://localhost:87825
#
#    Access from Docker Container:
#      API: http://api:3001
#      Database: database:5432
#      Redis: redis:6379
#      MailHog: mailhog:1025
#
# 5. OAuth Apps Setup:
#    IMPORTANT: Use port 87001 for local callback URLs
#    Google: https://console.cloud.google.com/apis/credentials
#      Callback: http://localhost:87001/auth/oauth/callback/google
#    GitHub: https://github.com/settings/developers
#      Callback: http://localhost:87001/auth/oauth/callback/github
#
# 6. Secret Generation Commands:
#    Cookie/Session secrets: openssl rand -hex 32
#    JWT keys: npm run generate-keys
#    Random password: openssl rand -base64 24
#
# ============================================================================
