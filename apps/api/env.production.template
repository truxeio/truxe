# Heimdall Production Environment Configuration
# 
# This template provides all production hardening environment variables
# for enterprise-grade deployment with comprehensive security, performance
# optimization, monitoring, and disaster recovery capabilities.
#
# Copy this file to .env.production and configure for your environment

# =============================================================================
# CORE APPLICATION CONFIGURATION
# =============================================================================

# Environment
NODE_ENV=production
LOG_LEVEL=info
PORT=3001

# Domain Configuration
DOMAIN=yourdomain.com
CORS_ORIGIN=https://yourapp.com,https://www.yourapp.com
CORS_CREDENTIALS=true

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# Primary Database
DATABASE_URL=postgresql://user:password@host:5432/heimdall
DATABASE_SSL=true
DATABASE_POOL_SIZE=20
DATABASE_STATEMENT_TIMEOUT=30000
DATABASE_IDLE_TIMEOUT=10000

# Database Performance
ENABLE_QUERY_OPTIMIZATION=true
SLOW_QUERY_THRESHOLD=1000

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================

# Redis Cache
REDIS_URL=redis://user:password@host:6379
REDIS_TLS=true
REDIS_KEY_PREFIX=heimdall:
REDIS_RETRY_DELAY=1000
REDIS_MAX_RETRIES=3

# =============================================================================
# JWT CONFIGURATION
# =============================================================================

# JWT Keys (use file paths for production)
JWT_PRIVATE_KEY_FILE=/run/secrets/jwt_private_key
JWT_PUBLIC_KEY_FILE=/run/secrets/jwt_public_key
JWT_ALGORITHM=RS256
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d
JWT_ISSUER=https://auth.yourdomain.com

# =============================================================================
# EMAIL SERVICE CONFIGURATION
# =============================================================================

# Email Provider (resend, ses, smtp)
EMAIL_PROVIDER=resend
EMAIL_API_KEY_FILE=/run/secrets/email_api_key
EMAIL_FROM=noreply@yourdomain.com

# SMTP Configuration (if using SMTP)
SMTP_HOST=smtp.yourdomain.com
SMTP_PORT=587
SMTP_SECURE=true
SMTP_USER=your-smtp-user
SMTP_PASS_FILE=/run/secrets/smtp_password

# =============================================================================
# SECURITY HARDENING CONFIGURATION
# =============================================================================

# Security Features
ENABLE_SECURITY_HARDENING=true
SECURITY_LEVEL=production
ENABLE_THREAT_DETECTION=true
ENABLE_SECURITY_HEADERS=true

# Rate Limiting
ENABLE_RATE_LIMITING=true
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# DDoS Protection
DDOS_PROTECTION_ENABLED=true
DDOS_THRESHOLD_REQUESTS_PER_MINUTE=1000
DDOS_THRESHOLD_UNIQUE_IPS=500

# =============================================================================
# PRODUCTION ERROR HANDLING
# =============================================================================

# Error Handler
ENABLE_PRODUCTION_ERROR_HANDLER=true
ERROR_HANDLER_FAILURE_THRESHOLD=5
ERROR_HANDLER_RECOVERY_TIMEOUT=60000
ERROR_HANDLER_MAX_RECOVERY_ATTEMPTS=3

# Circuit Breaker
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60000

# =============================================================================
# PERFORMANCE OPTIMIZATION
# =============================================================================

# Performance Optimizer
ENABLE_PERFORMANCE_OPTIMIZER=true
CACHE_STRATEGY=cache_aside
CACHE_TTL=3600
ENABLE_QUERY_OPTIMIZATION=true

# Memory Management
ENABLE_GC_OPTIMIZATION=true
MEMORY_THRESHOLD=0.85
MEMORY_MONITORING_INTERVAL=60000

# Node.js Optimization
NODE_OPTIONS=--max-old-space-size=512
UV_THREADPOOL_SIZE=16

# =============================================================================
# MONITORING AND OBSERVABILITY
# =============================================================================

# Monitoring Services
ENABLE_MONITORING_SERVICE=true
ENABLE_PROMETHEUS_METRICS=true
ENABLE_STRUCTURED_LOGGING=true
ENABLE_REAL_TIME_ALERTS=true

# APM Configuration
APM_SERVICE_NAME=heimdall-api
APM_SERVICE_VERSION=1.0.0
APM_ENVIRONMENT=production

# Metrics
METRICS_PORT=9090
METRICS_PREFIX=heimdall_
COLLECT_DEFAULT_METRICS=true

# Logging
LOG_LEVEL=info
ENABLE_REQUEST_LOGGING=false
ENABLE_QUERY_LOGGING=false

# Elasticsearch (optional)
ELASTICSEARCH_ENABLED=false
ELASTICSEARCH_URL=http://localhost:9200

# =============================================================================
# ALERTING CONFIGURATION
# =============================================================================

# Alert Channels
WEBHOOK_URL=https://your-monitoring-webhook.com
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
ALERT_EMAIL=alerts@yourdomain.com

# Alert Notification Channels
ALERT_NOTIFICATIONS_ENABLED=true
ALERT_NOTIFICATIONS_DEDUP_WINDOW=5m
ALERT_NOTIFICATIONS_MAX_RETRIES=3
ALERT_NOTIFICATIONS_RETRY_DELAY=5s
ALERT_NOTIFICATIONS_RETRY_BACKOFF=15s

# Email Alerts
ALERT_EMAIL_ENABLED=true
ALERT_EMAIL_RECIPIENTS=ops@yourdomain.com,team@yourdomain.com

# Slack Alerts
ALERT_SLACK_ENABLED=true
ALERT_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/XXX/YYY/ZZZ
ALERT_SLACK_CHANNEL=#alerts

# PagerDuty Alerts
ALERT_PAGERDUTY_ENABLED=false
ALERT_PAGERDUTY_INTEGRATION_KEY=your_pagerduty_integration_key
ALERT_PAGERDUTY_SOURCE=Heimdall API
ALERT_PAGERDUTY_SERVICE=alert-notifications

# Alert Thresholds
ALERT_ERROR_RATE_THRESHOLD=0.05
ALERT_RESPONSE_TIME_THRESHOLD=1000
ALERT_MEMORY_THRESHOLD=0.85
ALERT_CPU_THRESHOLD=0.80

# =============================================================================
# DISASTER RECOVERY AND BACKUP
# =============================================================================

# Automated Backups
ENABLE_AUTOMATED_BACKUPS=true
BACKUP_SCHEDULE_FULL="0 2 * * 0"
BACKUP_SCHEDULE_INCREMENTAL="0 */6 * * *"
BACKUP_SCHEDULE_DIFFERENTIAL="0 2 * * 1-6"
BACKUP_RETENTION_DAYS=90

# Cloud Storage
S3_BACKUP_BUCKET=heimdall-backups
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID_FILE=/run/secrets/aws_access_key_id
AWS_SECRET_ACCESS_KEY_FILE=/run/secrets/aws_secret_access_key

# Google Cloud Storage (alternative)
GCS_PROJECT_ID=your-gcs-project
GCS_BACKUP_BUCKET=heimdall-backups-gcs
GOOGLE_APPLICATION_CREDENTIALS=/run/secrets/gcs-service-account.json

# Backup Encryption
BACKUP_ENCRYPTION_ENABLED=true
BACKUP_ENCRYPTION_KEY_FILE=/run/secrets/backup_encryption_key

# Recovery Objectives
RECOVERY_TIME_OBJECTIVE=900  # 15 minutes
RECOVERY_POINT_OBJECTIVE=300 # 5 minutes

# =============================================================================
# SSL/TLS CONFIGURATION
# =============================================================================

# SSL Configuration
SSL_ENABLED=true
SSL_CERT_PATH=/etc/ssl/certs/
SSL_KEY_PATH=/etc/ssl/private/

# Let's Encrypt
ACME_EMAIL=admin@yourdomain.com
ACME_STAGING=false

# =============================================================================
# LOAD TESTING CONFIGURATION
# =============================================================================

# Load Testing
LOAD_TEST_ENABLED=true
LOAD_TEST_TARGET_RPS=167
LOAD_TEST_MAX_VUS=200
LOAD_TEST_DURATION=30m

# Performance Targets
PERFORMANCE_TARGET_P95_MS=200
PERFORMANCE_TARGET_P99_MS=500
PERFORMANCE_TARGET_ERROR_RATE=0.001
PERFORMANCE_TARGET_THROUGHPUT=167

# =============================================================================
# WEBHOOK CONFIGURATION
# =============================================================================

# Webhooks
ENABLE_WEBHOOKS=true
WEBHOOK_SECRET_FILE=/run/secrets/webhook_secret
WEBHOOK_TIMEOUT=10000
WEBHOOK_RETRY_ATTEMPTS=3

# =============================================================================
# ORGANIZATION FEATURES
# =============================================================================

# Multi-tenancy
ENABLE_ORGANIZATIONS=true
ENABLE_RBAC=true
MAX_ORGANIZATIONS_PER_USER=10
MAX_MEMBERS_PER_ORGANIZATION=100

# =============================================================================
# SESSION CONFIGURATION
# =============================================================================

# Advanced Session Security
MAX_CONCURRENT_SESSIONS=5
ENABLE_DEVICE_TRACKING=true
ENABLE_IMPOSSIBLE_TRAVEL_DETECTION=true
SESSION_CLEANUP_INTERVAL=3600000

# JTI Blacklist
JTI_BLACKLIST_TTL=2592000

# =============================================================================
# DEVELOPMENT AND DEBUG (disable in production)
# =============================================================================

# Debug Features (set to false in production)
DEBUG=false
ENABLE_SWAGGER=false
ENABLE_CORS_DEBUG=false
ENABLE_VERBOSE_LOGGING=false

# =============================================================================
# HEALTH CHECK CONFIGURATION
# =============================================================================

# Health Checks
HEALTH_CHECK_INTERVAL=30000
HEALTH_CHECK_TIMEOUT=5000
ENABLE_DEEP_HEALTH_CHECKS=true

# Service Dependencies
CHECK_DATABASE_HEALTH=true
CHECK_REDIS_HEALTH=true
CHECK_EMAIL_HEALTH=true

# =============================================================================
# CONTAINER ORCHESTRATION
# =============================================================================

# Docker/Kubernetes
CONTAINER_NAME=heimdall-api
REPLICA_COUNT=3
RESOURCE_LIMITS_MEMORY=512Mi
RESOURCE_LIMITS_CPU=500m

# =============================================================================
# ADVANCED PRODUCTION HARDENING
# =============================================================================

# Production Integration
ENABLE_PRODUCTION_HARDENING=true
ENABLE_PRODUCTION_INTEGRATION=true
PRODUCTION_SERVICES_STARTUP_TIMEOUT=30000
PRODUCTION_SERVICES_SHUTDOWN_TIMEOUT=15000

# Advanced Error Handling
ERROR_HANDLER_FAILURE_THRESHOLD=5
ERROR_HANDLER_RECOVERY_TIMEOUT=60000
ERROR_HANDLER_MAX_RECOVERY_ATTEMPTS=3
ERROR_HANDLER_ENABLE_AUTO_RECOVERY=true
ERROR_HANDLER_ERROR_WINDOW_SIZE=300000
ERROR_HANDLER_MAX_ERRORS_IN_WINDOW=100

# Performance Optimization
CACHE_STRATEGY=cache_aside
CACHE_TTL=3600
CACHE_PREFIX=heimdall:cache:
ENABLE_QUERY_OPTIMIZATION=true
SLOW_QUERY_THRESHOLD=1000
ENABLE_CONNECTION_POOL_OPTIMIZATION=true
ENABLE_MEMORY_OPTIMIZATION=true
MEMORY_THRESHOLD=0.85
ENABLE_GC_OPTIMIZATION=true

# Monitoring & Observability
ENABLE_PROMETHEUS_METRICS=true
ENABLE_STRUCTURED_LOGGING=true
ENABLE_REAL_TIME_ALERTS=true
ENABLE_BUSINESS_METRICS=true
ENABLE_INFRASTRUCTURE_MONITORING=true
MONITORING_INTERVAL=30000

# Alerting Channels
WEBHOOK_URL=https://your-monitoring-webhook.com
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
EMAIL_ALERTS_ENABLED=true
ALERT_EMAIL=alerts@yourdomain.com

# Security Hardening
ENABLE_SECURITY_HARDENING=true
SECURITY_LEVEL=production
ENABLE_THREAT_DETECTION=true
ENABLE_SECURITY_HEADERS=true
ENABLE_RATE_LIMITING=true
ENABLE_DDOS_PROTECTION=true
ENABLE_INPUT_VALIDATION=true
ENABLE_SQL_INJECTION_PROTECTION=true
ENABLE_XSS_PROTECTION=true
ENABLE_COMMAND_INJECTION_PROTECTION=true

# Threat Detection Patterns
SQL_INJECTION_PATTERNS_ENABLED=true
XSS_PATTERNS_ENABLED=true
COMMAND_INJECTION_PATTERNS_ENABLED=true
PATH_TRAVERSAL_PATTERNS_ENABLED=true
SUSPICIOUS_USER_AGENT_DETECTION=true

# Rate Limiting Configuration
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=false
RATE_LIMIT_SKIP_FAILED_REQUESTS=false

# DDoS Protection
DDOS_PROTECTION_ENABLED=true
DDOS_THRESHOLD_REQUESTS_PER_MINUTE=1000
DDOS_THRESHOLD_UNIQUE_IPS=500
DDOS_BLOCK_DURATION=300000

# =============================================================================
# PRODUCTION VALIDATION
# =============================================================================

# Production Readiness Checks
VALIDATE_PRODUCTION_READINESS=true
CHECK_ALL_SERVICES_HEALTHY=true
CHECK_PERFORMANCE_TARGETS=true
CHECK_SECURITY_CONFIGURATION=true
CHECK_BACKUP_SYSTEM=true

# Performance Validation
VALIDATE_RESPONSE_TIME_P95=true
VALIDATE_RESPONSE_TIME_P99=true
VALIDATE_ERROR_RATE=true
VALIDATE_THROUGHPUT=true
VALIDATE_UPTIME=true

# Security Validation
VALIDATE_SECURITY_HEADERS=true
VALIDATE_CORS_CONFIGURATION=true
VALIDATE_RATE_LIMITING=true
VALIDATE_THREAT_DETECTION=true
VALIDATE_INPUT_VALIDATION=true
RESOURCE_REQUESTS_MEMORY=256Mi
RESOURCE_REQUESTS_CPU=100m

# =============================================================================
# NETWORKING
# =============================================================================

# Network Configuration
TRUST_PROXY=true
MAX_REQUEST_SIZE=1mb
TIMEOUT=30000

# IP Allowlisting (optional)
IP_ALLOWLIST_ENABLED=false
IP_ALLOWLIST=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# =============================================================================
# COMPLIANCE AND AUDIT
# =============================================================================

# Compliance
ENABLE_AUDIT_LOGGING=true
AUDIT_LOG_RETENTION_DAYS=365
GDPR_COMPLIANCE_MODE=true
HIPAA_COMPLIANCE_MODE=false

# Data Retention
USER_DATA_RETENTION_DAYS=2555  # 7 years
SESSION_DATA_RETENTION_DAYS=90
LOG_RETENTION_DAYS=365

# =============================================================================
# FEATURE FLAGS
# =============================================================================

# Feature Toggles
ENABLE_MAGIC_LINKS=true
ENABLE_PASSWORD_AUTH=false
ENABLE_OAUTH=false
ENABLE_MFA=false
ENABLE_ANALYTICS=true

# =============================================================================
# THIRD-PARTY INTEGRATIONS
# =============================================================================

# Sentry (Error Tracking)
SENTRY_DSN=https://your-sentry-dsn
SENTRY_ENVIRONMENT=production
SENTRY_RELEASE=1.0.0

# Analytics
ANALYTICS_ENABLED=true
ANALYTICS_PROVIDER=mixpanel
ANALYTICS_API_KEY_FILE=/run/secrets/analytics_api_key

# =============================================================================
# SECRETS MANAGEMENT
# =============================================================================

# Secrets Path (for Docker Secrets or Kubernetes Secrets)
SECRETS_PATH=/run/secrets

# Vault Integration (optional)
VAULT_ENABLED=false
VAULT_URL=https://vault.yourdomain.com
VAULT_TOKEN_FILE=/run/secrets/vault_token

# =============================================================================
# PRODUCTION VALIDATION
# =============================================================================

# Startup Validation
ENABLE_STARTUP_VALIDATION=true
VALIDATE_SECRETS=true
VALIDATE_CONNECTIVITY=true
VALIDATE_PERMISSIONS=true

# =============================================================================
# NOTES AND DOCUMENTATION
# =============================================================================

# Configuration Notes:
# 1. All sensitive values should use _FILE suffix to read from files
# 2. Use Docker Secrets or Kubernetes Secrets for sensitive data
# 3. Adjust resource limits based on your infrastructure
# 4. Enable only the features you need
# 5. Review and test all configurations in staging first
# 6. Monitor all metrics after deployment
# 7. Test disaster recovery procedures regularly
# 8. Keep this configuration file secure and version controlled (without secrets)

# For more information, see:
# - docs/03-implementation/deployment-guide.md
# - docs/05-guides/production-configuration.md
# - PRODUCTION-HARDENING-HANDOVER.md
