# Truxe Deployment

This directory contains all deployment-related files for Truxe.

## Quick Start (Recommended - Standalone)

For a fresh server deployment:

```bash
# 1. Clone repository on your server
git clone git@github.com:Wundam/Truxe.git
cd Truxe/deployment

# 2. Run quick setup wizard
./scripts/quick-setup.sh

# 3. Deploy
./scripts/deploy-standalone.sh
```

That's it! Your API will be available at `https://api.yourdomain.com`

## Directory Structure

```
deployment/
├── scripts/              # Deployment automation scripts
│   ├── quick-setup.sh          # Interactive setup wizard (START HERE)
│   ├── deploy-standalone.sh    # Standalone deployment script
│   ├── setup-git-ssh.sh        # Git SSH key setup helper
│   └── setup-passwordless-sudo.sh  # Sudo setup for deployment user
│
├── docs/                 # Deployment documentation
│   ├── STANDALONE_DEPLOYMENT.md    # Complete standalone guide (RECOMMENDED)
│   ├── DEPLOYMENT_COMPARISON.md    # Dokploy vs Standalone comparison
│   ├── DOKPLOY_DEPLOYMENT_GUIDE.md # Dokploy deployment guide
│   └── ...
│
├── docker-compose.standalone.yml  # Standalone stack with Traefik
└── .env.standalone.example        # Environment configuration template
```

## Prerequisites

- Ubuntu 20.04+ server
- Docker installed
- Domain with DNS configured
- Brevo API key (for emails)

## Deployment Methods

### 1. Standalone (Recommended) ⭐

**Best for:** Fresh deployments, simplicity, full control

**Features:**
- Dedicated Traefik instance
- Automatic SSL with Let's Encrypt
- Single-command deployment
- Easy debugging
- No conflicts

**Guide:** [docs/STANDALONE_DEPLOYMENT.md](docs/STANDALONE_DEPLOYMENT.md)

### 2. Dokploy

**Best for:** Multi-app deployments with existing Dokploy

**Features:**
- Shared Traefik
- UI-based management
- Good for multiple apps

**Guide:** [docs/DOKPLOY_DEPLOYMENT_GUIDE.md](docs/DOKPLOY_DEPLOYMENT_GUIDE.md)

**Comparison:** [docs/DEPLOYMENT_COMPARISON.md](docs/DEPLOYMENT_COMPARISON.md)

## Server Requirements

### Minimum
- 2 vCPU
- 4 GB RAM
- 40 GB SSD
- Ubuntu 22.04 LTS

### Recommended (Hetzner CPX21)
- 3 vCPU
- 4 GB RAM
- 80 GB SSD
- ~€5.83/month

## DNS Configuration

Before deployment, configure these DNS records:

```
A  api.yourdomain.com      → Your Server IP
A  traefik.yourdomain.com  → Your Server IP
```

## First Time Setup

```bash
# On your server
cd deployment

# Run interactive setup (asks all questions, generates secrets)
./scripts/quick-setup.sh

# Deploy
./scripts/deploy-standalone.sh
```

The setup wizard will:
- ✅ Ask for your domain and email
- ✅ Generate strong passwords (DB, Redis)
- ✅ Generate JWT keys
- ✅ Generate security secrets
- ✅ Configure Traefik dashboard auth
- ✅ Save everything to `.env.standalone`
- ✅ Optionally start deployment

## Configuration

All configuration is in `.env.standalone`:

```bash
DOMAIN=example.com
ACME_EMAIL=admin@example.com
DB_PASSWORD=<auto-generated>
REDIS_PASSWORD=<auto-generated>
JWT_PRIVATE_KEY_BASE64=<auto-generated>
JWT_PUBLIC_KEY_BASE64=<auto-generated>
BREVO_API_KEY=<your-key>
# ... and more
```

## Useful Commands

```bash
# View logs
docker compose -f docker-compose.standalone.yml logs -f api

# Restart API
docker compose -f docker-compose.standalone.yml restart api

# Check status
docker compose -f docker-compose.standalone.yml ps

# Stop everything
docker compose -f docker-compose.standalone.yml down
```

## Testing Deployment

```bash
# Health check
curl https://api.yourdomain.com/health

# API info
curl https://api.yourdomain.com/

# Traefik dashboard
open https://traefik.yourdomain.com
```

## Troubleshooting

See [docs/STANDALONE_DEPLOYMENT.md](docs/STANDALONE_DEPLOYMENT.md#troubleshooting) for common issues and solutions.

## Security

- All secrets auto-generated (32+ characters)
- SSL/TLS via Let's Encrypt
- Internal network for database/redis
- Firewall: Only ports 22, 80, 443 open
- Non-root container user
- Traefik dashboard password-protected

## Support

- **Standalone deployment issues:** [docs/STANDALONE_DEPLOYMENT.md](docs/STANDALONE_DEPLOYMENT.md)
- **Dokploy deployment issues:** [docs/DOKPLOY_DEPLOYMENT_GUIDE.md](docs/DOKPLOY_DEPLOYMENT_GUIDE.md)
- **Comparison:** [docs/DEPLOYMENT_COMPARISON.md](docs/DEPLOYMENT_COMPARISON.md)
