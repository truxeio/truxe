# Heimdall API - Rate Limiting & API Protection Configuration
# Copy this to .env and configure for your environment

# =============================================================================
# RATE LIMITING CONFIGURATION
# =============================================================================

# Magic Link Rate Limits
RATE_LIMIT_MAGIC_LINK_PER_IP=5
RATE_LIMIT_MAGIC_LINK_WINDOW=1m
RATE_LIMIT_MAGIC_LINK_PER_EMAIL=3
RATE_LIMIT_MAGIC_LINK_EMAIL_WINDOW=1h

# Verification Rate Limits
RATE_LIMIT_VERIFY_PER_IP=10
RATE_LIMIT_VERIFY_WINDOW=1m
RATE_LIMIT_VERIFY_PER_TOKEN=3

# Refresh Token Rate Limits
RATE_LIMIT_REFRESH_PER_USER=60
RATE_LIMIT_REFRESH_WINDOW=1h

# Global Rate Limits
RATE_LIMIT_GLOBAL_MAX=1000
RATE_LIMIT_GLOBAL_WINDOW=1h

# =============================================================================
# DDOS PROTECTION CONFIGURATION
# =============================================================================

# DDoS Detection Thresholds
DDOS_SUSPICIOUS_IP_THRESHOLD=1000          # Requests per minute from single IP
DDOS_GLOBAL_SPIKE_THRESHOLD=10000          # Global requests per minute
DDOS_FAILED_AUTH_THRESHOLD=50              # Failed auth attempts per IP per hour
DDOS_CIRCUIT_BREAKER_THRESHOLD=5           # Failures before circuit breaker opens
DDOS_CIRCUIT_BREAKER_TIMEOUT=1m            # Circuit breaker timeout

# =============================================================================
# PLAN-BASED QUOTAS CONFIGURATION
# =============================================================================

# Free Plan Limits
PLAN_FREE_EMAILS_PER_MONTH=1000
PLAN_FREE_EMAILS_PER_USER_PER_DAY=10
PLAN_FREE_API_REQUESTS_PER_HOUR=1000
PLAN_FREE_MAGIC_LINKS_PER_HOUR=5
PLAN_FREE_REFRESH_TOKENS_PER_HOUR=60
PLAN_FREE_CONCURRENT_SESSIONS=3

# Starter Plan Limits
PLAN_STARTER_EMAILS_PER_MONTH=10000
PLAN_STARTER_EMAILS_PER_USER_PER_DAY=50
PLAN_STARTER_API_REQUESTS_PER_HOUR=10000
PLAN_STARTER_MAGIC_LINKS_PER_HOUR=20
PLAN_STARTER_REFRESH_TOKENS_PER_HOUR=300
PLAN_STARTER_CONCURRENT_SESSIONS=5

# Pro Plan Limits
PLAN_PRO_EMAILS_PER_MONTH=100000
PLAN_PRO_EMAILS_PER_USER_PER_DAY=200
PLAN_PRO_API_REQUESTS_PER_HOUR=100000
PLAN_PRO_MAGIC_LINKS_PER_HOUR=100
PLAN_PRO_REFRESH_TOKENS_PER_HOUR=1000
PLAN_PRO_CONCURRENT_SESSIONS=10

# Enterprise Plan (unlimited) - no configuration needed

# =============================================================================
# MONITORING & ALERTING CONFIGURATION
# =============================================================================

# Alert Webhook URLs
ALERT_WEBHOOK_URL=https://your-monitoring-system.com/webhook
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
ALERT_EMAIL=alerts@yourcompany.com

# Alert Thresholds
ALERT_THRESHOLD_RATE_LIMIT_VIOLATIONS=100    # Per minute
ALERT_THRESHOLD_DDOS_ATTACKS=5               # Per hour
ALERT_THRESHOLD_SECURITY_THREATS=50          # Per minute
ALERT_THRESHOLD_ERROR_RATE=5                 # Percentage
ALERT_THRESHOLD_RESPONSE_TIME=1000           # Milliseconds
ALERT_THRESHOLD_BLOCKED_REQUESTS=200         # Per minute

# Metrics Retention
METRICS_RETENTION_MINUTE=1h
METRICS_RETENTION_HOUR=24h
METRICS_RETENTION_DAY=30d

# =============================================================================
# ADMIN CONFIGURATION
# =============================================================================

# Admin API Token (generate a secure random token)
ADMIN_TOKEN=your-secure-admin-token-here

# Admin IP Whitelist (comma-separated)
ADMIN_ALLOWED_IPS=127.0.0.1,10.0.0.0/8,192.168.0.0/16

# Admin Rate Limit Bypass
ADMIN_RATE_LIMIT_BYPASS=true

# =============================================================================
# SECURITY FEATURES
# =============================================================================

# Enable/Disable Security Features
ENABLE_RATE_LIMITING=true
ENABLE_DDOS_PROTECTION=true
ENABLE_SECURITY_ANALYSIS=true
ENABLE_IP_BLOCKING=true
ENABLE_PLAN_ENFORCEMENT=true

# Security Thresholds
SECURITY_THREAT_BLOCK_THRESHOLD=0.8          # Risk score threshold for blocking
SECURITY_IP_BLOCK_DURATION=3600000           # 1 hour in milliseconds

# =============================================================================
# REDIS CONFIGURATION (for rate limiting)
# =============================================================================

REDIS_URL=redis://localhost:6379
REDIS_KEY_PREFIX=heimdall:
REDIS_RETRY_DELAY=100
REDIS_MAX_RETRIES=3

# =============================================================================
# EXAMPLE PRODUCTION CONFIGURATION
# =============================================================================

# For production environments, consider these more restrictive settings:

# Production Rate Limits (commented out - uncomment to use)
# RATE_LIMIT_MAGIC_LINK_PER_IP=3
# RATE_LIMIT_MAGIC_LINK_PER_EMAIL=2
# RATE_LIMIT_VERIFY_PER_IP=5
# DDOS_SUSPICIOUS_IP_THRESHOLD=500
# DDOS_GLOBAL_SPIKE_THRESHOLD=5000

# Production Alert Thresholds (commented out - uncomment to use)
# ALERT_THRESHOLD_RATE_LIMIT_VIOLATIONS=50
# ALERT_THRESHOLD_DDOS_ATTACKS=3
# ALERT_THRESHOLD_SECURITY_THREATS=25
# ALERT_THRESHOLD_ERROR_RATE=3
# ALERT_THRESHOLD_RESPONSE_TIME=500

# =============================================================================
# DEVELOPMENT CONFIGURATION
# =============================================================================

# For development environments, you might want more lenient settings:

# Development Rate Limits (commented out - uncomment to use)
# RATE_LIMIT_MAGIC_LINK_PER_IP=20
# RATE_LIMIT_MAGIC_LINK_PER_EMAIL=10
# RATE_LIMIT_VERIFY_PER_IP=50
# ENABLE_RATE_LIMITING=false
# ENABLE_DDOS_PROTECTION=false

# =============================================================================
# TESTING CONFIGURATION
# =============================================================================

# For testing environments, disable most restrictions:

# Test Configuration (commented out - uncomment to use)
# ENABLE_RATE_LIMITING=false
# ENABLE_DDOS_PROTECTION=false
# ENABLE_SECURITY_ANALYSIS=false
# ENABLE_IP_BLOCKING=false
# ENABLE_PLAN_ENFORCEMENT=false
