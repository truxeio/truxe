{
  "id": "auth-password-flow",
  "name": "Password Registration & Login",
  "description": "Complete user registration with email verification and login flow",
  "category": "auth",
  "version": "1.0.0",
  "author": "Truxe Team",
  "tags": ["authentication", "registration", "email-verification", "login"],
  "isPrebuilt": true,
  "createdAt": "2023-11-10T00:00:00Z",
  "updatedAt": "2023-11-10T00:00:00Z",
  "variables": [
    {
      "key": "baseUrl",
      "value": "{{baseUrl}}",
      "type": "environment",
      "scope": "workflow",
      "enabled": true,
      "description": "Base API URL",
      "createdAt": "2023-11-10T00:00:00Z",
      "updatedAt": "2023-11-10T00:00:00Z"
    },
    {
      "key": "email",
      "value": "{{$randomEmail}}",
      "type": "dynamic",
      "scope": "workflow",
      "enabled": true,
      "description": "User email address",
      "createdAt": "2023-11-10T00:00:00Z",
      "updatedAt": "2023-11-10T00:00:00Z"
    },
    {
      "key": "password",
      "value": "TestPass123!",
      "type": "workflow",
      "scope": "workflow",
      "enabled": true,
      "description": "User password",
      "isSecret": true,
      "createdAt": "2023-11-10T00:00:00Z",
      "updatedAt": "2023-11-10T00:00:00Z"
    },
    {
      "key": "firstName",
      "value": "Test",
      "type": "workflow",
      "scope": "workflow",
      "enabled": true,
      "description": "User first name",
      "createdAt": "2023-11-10T00:00:00Z",
      "updatedAt": "2023-11-10T00:00:00Z"
    },
    {
      "key": "lastName",
      "value": "User",
      "type": "workflow",
      "scope": "workflow",
      "enabled": true,
      "description": "User last name",
      "createdAt": "2023-11-10T00:00:00Z",
      "updatedAt": "2023-11-10T00:00:00Z"
    }
  ],
  "steps": [
    {
      "id": "register-user",
      "name": "Register New User",
      "description": "Create a new user account with email and password",
      "order": 1,
      "request": {
        "method": "POST",
        "url": "{{baseUrl}}/auth/register",
        "headers": {
          "Content-Type": "application/json",
          "Accept": "application/json"
        },
        "body": {
          "email": "{{email}}",
          "password": "{{password}}",
          "firstName": "{{firstName}}",
          "lastName": "{{lastName}}"
        }
      },
      "expectedResponse": {
        "status": [201, 200],
        "extractFields": ["userId", "verificationRequired"]
      },
      "extractVariables": {
        "userId": "$.userId",
        "verificationRequired": "$.verificationRequired",
        "registrationToken": "$.token"
      },
      "onSuccess": [
        {
          "type": "log",
          "params": {
            "message": "User registration successful"
          }
        }
      ],
      "onFailure": [
        {
          "type": "log",
          "params": {
            "message": "User registration failed"
          }
        }
      ],
      "timeout": 10000,
      "retries": 1
    },
    {
      "id": "verify-email",
      "name": "Verify Email Address",
      "description": "Verify user email with verification code",
      "order": 2,
      "request": {
        "method": "POST",
        "url": "{{baseUrl}}/auth/verify-email",
        "headers": {
          "Content-Type": "application/json",
          "Accept": "application/json",
          "Authorization": "Bearer {{registrationToken}}"
        },
        "body": {
          "userId": "{{userId}}",
          "verificationCode": "123456"
        }
      },
      "expectedResponse": {
        "status": [200, 201],
        "extractFields": ["verified"]
      },
      "extractVariables": {
        "emailVerified": "$.verified",
        "verificationToken": "$.token"
      },
      "condition": {
        "type": "variable",
        "expression": "verificationRequired == true",
        "description": "Only verify email if verification is required"
      },
      "onSuccess": [
        {
          "type": "log",
          "params": {
            "message": "Email verification successful"
          }
        }
      ],
      "onFailure": [
        {
          "type": "log",
          "params": {
            "message": "Email verification failed - you may need to use a real verification code"
          }
        }
      ],
      "timeout": 10000,
      "retries": 0
    },
    {
      "id": "login-user",
      "name": "Login User",
      "description": "Authenticate user with email and password",
      "order": 3,
      "request": {
        "method": "POST",
        "url": "{{baseUrl}}/auth/login",
        "headers": {
          "Content-Type": "application/json",
          "Accept": "application/json"
        },
        "body": {
          "email": "{{email}}",
          "password": "{{password}}"
        }
      },
      "expectedResponse": {
        "status": 200,
        "extractFields": ["accessToken", "refreshToken", "user"]
      },
      "extractVariables": {
        "accessToken": "$.accessToken",
        "refreshToken": "$.refreshToken",
        "userInfo": "$.user",
        "expiresAt": "$.expiresAt"
      },
      "onSuccess": [
        {
          "type": "log",
          "params": {
            "message": "User login successful"
          }
        },
        {
          "type": "set-variable",
          "params": {
            "key": "Authorization",
            "value": "Bearer {{accessToken}}"
          }
        }
      ],
      "onFailure": [
        {
          "type": "log",
          "params": {
            "message": "User login failed"
          }
        }
      ],
      "timeout": 10000,
      "retries": 1
    },
    {
      "id": "get-user-profile",
      "name": "Get User Profile",
      "description": "Fetch authenticated user profile to verify login",
      "order": 4,
      "request": {
        "method": "GET",
        "url": "{{baseUrl}}/auth/me",
        "headers": {
          "Accept": "application/json",
          "Authorization": "Bearer {{accessToken}}"
        }
      },
      "expectedResponse": {
        "status": 200,
        "extractFields": ["id", "email"]
      },
      "extractVariables": {
        "profileData": "$",
        "userRole": "$.role",
        "emailVerifiedStatus": "$.emailVerified"
      },
      "onSuccess": [
        {
          "type": "log",
          "params": {
            "message": "User profile retrieved successfully"
          }
        }
      ],
      "onFailure": [
        {
          "type": "log",
          "params": {
            "message": "Failed to retrieve user profile"
          }
        }
      ],
      "timeout": 10000,
      "retries": 1
    },
    {
      "id": "update-profile",
      "name": "Update User Profile",
      "description": "Update user profile information",
      "order": 5,
      "request": {
        "method": "PUT",
        "url": "{{baseUrl}}/users/{{userId}}",
        "headers": {
          "Content-Type": "application/json",
          "Accept": "application/json",
          "Authorization": "Bearer {{accessToken}}"
        },
        "body": {
          "firstName": "{{firstName}}",
          "lastName": "{{lastName}}",
          "bio": "Updated via workflow test"
        }
      },
      "expectedResponse": {
        "status": [200, 204],
        "extractFields": ["id"]
      },
      "extractVariables": {
        "updatedProfile": "$"
      },
      "onSuccess": [
        {
          "type": "log",
          "params": {
            "message": "Profile update successful"
          }
        }
      ],
      "onFailure": [
        {
          "type": "log",
          "params": {
            "message": "Profile update failed"
          }
        }
      ],
      "timeout": 10000,
      "retries": 1
    }
  ]
}